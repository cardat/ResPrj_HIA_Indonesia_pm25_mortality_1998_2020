---
title: "PM~2.5~ and all-cause mortality health impact assessment in Indonesia, 1998-2020"
date: "`r Sys.Date()`"
output: bookdown::html_document2
---

```{r setup, include=FALSE}
library(knitr)
library(data.table)
library(targets)
knitr::opts_chunk$set(echo = FALSE, message = FALSE)

```

## Health Impact Assessment

In Indonesia, the mean exposure to PM~2.5~ (for a subset of study years) is shown in Figure \@ref(fig:plt-exposure) by province. Mortality counts are displayed in Figure \@ref(fig:plt-mortality).


```{r plt-exposure, fig.cap = "Mean exposure by province."}
# path must be relative to the output html to show the plot
# ignore the error while rendering (issue with root/working directory for pandoc vs output html)
knitr::include_graphics(
  file.path("..", grep("exposure", targets::tar_read(fig_map_inputs_facet), value = T)), 
  error = F
)
```

```{r plt-mortality, fig.cap = "Mortality counts by province."}
knitr::include_graphics(
  file.path("..", grep("exposure", targets::tar_read(fig_map_inputs_facet), value = T)), 
  error = F
)
```

Exposure to PM~2.5~, counterfactual PM~2.5~ concentration, expected mortality and attributable number of deaths for the year 2020 is shown in Table \@ref(tab:tbl-sample-year).

```{r tbl-sample-year}
data_exposure_health <- targets::tar_read(data_combine_exposure_response)
dat_an <- targets::tar_read(data_attributable_number)

data_exposure_health[, attributable := dat_an]
data_exposure_health <- data_exposure_health[, .(
  Population = sum(pop, na.rm = T),
  "Expected Deaths" = sum(count, na.rm = T),
  "Attributable Deaths" = sum(attributable, na.rm = T),
  "Mean CF PM2.5 Exposure" = mean(counterfactual, na.rm = T),
  "Mean baseline PM2.5 Exposure" = mean(exposure_value, na.rm = T)
), by = .(Province = province, Year = year)]

# show one year
knitr::kable(data_exposure_health[Year == 2020],
             caption = "Attributable number of deaths (PM2.5) by province for the year 2020 with average PM2.5 (Î¼g/m3) population-weighted exposure for baseline case and counterfactual.",
             digits = c(0,0,0,0,0,1,1))
```